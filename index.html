<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patrick Feeney Design</title>
    <meta name="description" content="Patrick Feeney Designer">
    <link rel="icon" href="img/black_circle.png" type="image/png">
    <link rel="stylesheet" href="https://use.typekit.net/opq3sul.css">
    <link rel="stylesheet" href="https://use.typekit.net/kyu3tgb.css">
    <style>
        html, body {
            overflow-x: hidden;
            touch-action: manipulation;
        }

        header {
            position: fixed;
            text-align: left;
            border-radius: 0 0 40px 40px;
            background-color: rgb(180, 114, 255);
            right: -9vw;
            top: -0.1vw;
            margin: 0;
            padding: 0;
            z-index: 1000;
        }

        header.firstpage {
            position: fixed;
            text-align: left;
            margin: 0;
            height: 3vw;
            padding-left: 1vw;
            padding-right: 10vw;
            padding-top: 0.8vw;
            padding-bottom: 0.8vw;
            z-index: 4000;
            align-content: center;
        }

        header img {
            height: 1vw;
            width: auto;
            filter: invert(100%);
            padding: 0 0 0 1vw;
            transition: all 0.3s;
        }

        body {
            font-family: tt-commons-pro, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #eeeeee;
            scrollbar-width: none; 
        }

        #backButton {
            position: fixed;
            padding: 1vw 1.5vw;
            top: 0;
            left: 0;
            font-size: 1.2vw;
            font-weight: 700;
            background-color:  rgb(180, 114, 255);
            color: rgb(20, 20, 20);
            border: none;
            cursor: pointer;
            z-index: 1000;
        }

        .band {
            width: 100vw;
            height: 3vw;
            background-color: rgb(18, 18, 18);
            margin: 0;
            padding: 5vh 15vh 17vh 25vh;
        }

        .band h3 {
            font-weight: 200;
            margin: 0;
            padding: 0;
            font-size: 3vh;
            color: #eeeeee;
        }

        .band h1 {
            font-weight: 500;
            font-size: 6vh;
            padding: 0;
            margin: 0;
            color: #eeeeee;
        }

        .band h2 {
            font-weight: 400;
            padding: 1vh 1.6vh 1vh 2vh;
            margin: 2vh 0 0 0;
            width: 3.6vw;
            border-radius: 40px;
            font-size: 2vh;
        }

        .band h2:hover {
            border: none !important;
            color:rgb(26, 26, 26) !important;
            background-color: rgb(235, 235, 235) !important;
        }

        .band a {
            margin: 0;
            text-decoration: none;
            color: #706700;
        }

        article {
            background-color: #eeeeee;
            padding: 10vw 23vw;
        }

        article p {
            font-size: 1.3vw;
            line-height: 2.5vw;
        }

        article h2 {
            font-weight: 600;
        }

        .splash {
           background-color: rgb(18, 18, 18);
           padding: 8vw;
           color: #eeeeee;
        }

        .splash h1 {
           font-weight: 500;
           font-size: 3.8vw;
           line-height: 5vw;
        }

        .splash p {
           font-weight: 300;
           font-size: 2vw;
           line-height: 0;
           color:  rgb(180, 114, 255);
        }

        .bodyimg {
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 100vw; 
            height: 120vh; 
            overflow: hidden; 
            position: relative; 
            margin: 0; 
            padding: 5vw 0 5vw 0;
            background-color: rgb(16, 16, 16);
        }

        .bodyimg img {
            height: 70%; 
            width: auto; 
            object-fit: contain; 
            transition: transform 3s ease; 
        }

        .bodyimg img.zoom-effect {
            transform: scale(1.1); 
        }

        /* Footer */
        footer {
            background-color: #1d1c1c;
            height: 3.5vw;
            width: 32vw;
            position: fixed;
            bottom: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #e0e0e0;
            border-radius: 0px 30px 0 0;
        }

        .social-icons {
            display: flex;
            gap: 20px;
        }

        .social-icons a img {
            height: 1.2vw;
            width: auto;
            padding-left: 1vw;
            padding-right: 1vw;
        }

        .footer-text {
            color: #e0e0e0;
            font-size: 0.7vw;
            text-align: right;
            padding-left: 2vw;
            font-weight: 300;
        }

        footer.black-background .footer-text {
            color: #161717;
        }

        #container1, #container2 {
            width: 100vw;
            height: 120vh;
            position: relative;
            overflow: hidden;
            background-color: rgb(0, 0, 0);
            /*
            background-image:
                linear-gradient(to right, rgba(140, 40, 255, 0.3) 0.2px, transparent 1px),
                linear-gradient(to bottom, rgba(140, 40, 255, 0.3) 0.2px, transparent 1px);
            background-size: 100px 100px;
            */
        }

        /* Info-text styling */
        .info-text {
            position: absolute;
            top: 0;
            right: 0;
            color: rgb(234, 234, 234);
            background-color: rgb(27, 27, 27);
            padding: 0 30px 0 30px;
            font-weight: 400;
            font-size: 1.2rem;
            z-index: 100;
            display: inline-flex;
            align-items: center; 
            cursor: pointer;
        }

        .info-text:hover {
            background-color: #a35cf8;
            color: #161717;
        }

        .info-text:hover span {
            color: #161717;
        }

        .info-text span {
            font-weight: 500;
            color: rgb(180, 114, 255);
            margin: 0;
            padding-right: 10px;
            font-size: 1.4rem; /* slightly larger for icon look */
            line-height: 1;
            display: inline-block;
        }

        /* Limit the size of the draggable elements to a max width */
        .draggable {
            position: absolute;
            cursor: grab;
            user-select: none;
            max-width: 30vw;
            width: 100%; 
            height: auto;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .draggable img.low-res {
            width: 100%;
            height: auto;
            display: block;
            transition: filter 0.5s ease;
        }

        .draggable img.high-res {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            opacity: 0; /* Start hidden */
            transition: opacity 0.5s ease;
        }

        .draggable img.high-res.loaded {
            opacity: 1; /* Fade in when loaded */
        }


        /* Visual feedback classes */
        .draggable.dragging {
            transform: scale(1.1) rotate(1deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.766);
            cursor: grabbing;
        }

        .draggable.dropped {
            animation: bounce 2s ease;
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(0); }
        }

        .toggle-button2, .toggle-button1 {
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgb(234, 234, 234);
            color: rgb(19, 19, 19);
            border: none;
            padding: 10px 20px;
            font-size: 1.7rem;
            font-weight: 300;
            cursor: pointer;
            z-index: 100;
            transition: background-color 0.3s ease;
        }

        .toggle-button2:hover, .toggle-button1:hover {
            background-color: rgb(180, 114, 255);
            color: rgb(12, 12, 12);
        }

        #no2 {
            display: none;
        }

        /* Fade-in transition */
        .fade-in {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .fade-in.loaded {
            opacity: 1;
        }

        /* Mobile Styles */
        @media (max-width: 600px) {
            html, body {
                overflow-x: hidden;
            }

            body {
                font-size: 4vw; 
                line-height: 1.4;
            }

            header.firstpage {
                height: auto;
                padding: 2vw;
                right: 0;
                top: 0;
                border-radius: 0;
            }

            header img {
                height: 3vw; 
                width: auto;
            }

            #backButton {
                font-size: 4vw;
                padding: 2vw;
            }

            .band {
                padding: 10vw 5vw;
                height: auto;
            }
            .band h1 {
                font-size: 5vw;
                line-height: 1.2;
            }
            .band h2, .band h3 {
                font-size: 4vw;
                width: fit-content;
            }

            article {
                padding: 10vw 5vw;
            }

            article p {
                font-size: 4vw;
                line-height: 1.5;
            }

            .splash {
                padding: 10vw 5vw;
            }
            .splash h1 {
                font-size: 5vw;
                line-height: 1.3;
            }
            .splash p {
                font-size: 4vw;
                line-height: 1.2;
            }

            footer {
                width: 100%;
                height: 5vh;
                border-radius: 0;
                padding: 3vw;
                gap: 2vw;
                position: relative;
            }

            .social-icons a img {
                height: 3vw;
            }

            .footer-text {
                font-size: 2vw;
            }

            #mobilehide {
                display: none;
            }

            .mobilehide {
                display: none;
            }

            .toggle-button1, .toggle-button2 {
                font-size: 3vw;
                padding: 3vw;
            }

            .draggable {
                max-width: 50vw;
            }

            .info-text {
                font-size: 3vw;
            }

            .info-text span {
                font-size: 4vw;
            }

            .instruction-content {
                width: 55vw !important;
                padding: 50px 30px 50px 30px !important;
                border-radius: 20px;
            }

            .instruction-content h2 {
                font-size: 5.7vw !important;
            }

            .instruction-content p {
                font-size: 3vw !important;
            }
        }

        @media (min-width: 600px) {
            .desktophide {
                display: none;
            }
        }

        /* Wrapper that contains the interactive area and the overlay */
        .interactive-wrapper {
            position: relative;
        }

        /* Modal Overlay inside the interactive area */
        #instructionOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .instruction-content {
            max-width: 80%;
            background: #1f1f1f;
            color: #eee;
            padding: 4rem;
            text-align: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border-radius: 20px;
        }

        .instruction-content h2 {
            margin-top: 0;
            font-size: 2rem;
            font-weight: 500;
            margin-bottom: 0.9rem;
        }

        .instruction-content p {
            font-size: 1.2rem;
            margin-bottom: 1.7rem;
            line-height: 1.6;
        }

        .instruction-content span {
            font-weight: 500;
            color: rgb(180, 114, 255);
        }

        .close-overlay-btn {
            font-size: 1rem;
            padding: 0.7em 1.2em;
            margin-top: 0.5rem;
            background: #b472ff;
            color: #111;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }

        .close-overlay-btn:hover {
            background: #a35cf8;
        }

    </style>
</head>
<body>
    <button id="backButton" class="desktophide">&#x1F47E;</button>
    <button id="backButton" onclick="location.href='game.html';" class="mobilehide"></button>

    <header tabindex="0" aria-label="Home Button" class="firstpage">
        <a href="index.html" style="display: inline-block; cursor: pointer;">
            <img src="img/logo.png" alt="Logo">
        </a>
    </header>

    <article class="splash">
        <p>Patrick Feeney</p>
        <h1>I'm a visual designer working across branding, technology ethics, science communication, and interaction design.
        </h1>
    </article>

    <div class="interactive-wrapper">
        <!-- Instruction Overlay -->
        <div id="instructionOverlay">
            <div class="instruction-content">
                <h2>How to Navigate</h2>
                <p><span>Drag</span> an image to move it around,<br> or <span>double click</span> to learn more. <br> To see more projects, click<br> the <span>next</span> button.</p>
                <button class="close-overlay-btn" id="closeInstructionBtn">Got it!</button>
            </div>
        </div>

        <div id="no1">
            <div id="container1">
                <!-- Info-text acting as a button -->
                <div class="info-text" role="button" tabindex="0">
                    <p><span>&#9432;</span> How to Navigate</p> 
                </div>

                <button class="toggle-button1">Next Page &gt; </button>

                <!-- Draggable Items with Low-res and High-res Images -->
                <div class="draggable">
                    <a href="spec.html">
                        <img src="img/low/newspaper1.jpg" alt="Low-Res Image" class="low-res loading">
                        <img src="img/newspaper1.webp" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>
                
                <div class="draggable">
                    <a href="pol.html">
                        <img src="img/low/BLUE-jpeg-4.jpg" alt="Low-Res Image" class="low-res loading">
                        <img src="img/BLUE-jpeg-4.webp" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="gaze23.html">
                        <img src="img/low/GAZE_01.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/GAZE_01.webp" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="gaze24.html">
                        <img src="img/low/gazefilm.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/gazefilm.gif" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="trust.html">
                        <img src="img/low/Slide10.jpeg" alt="Low-Res Image" class="low-res loading">
                        <img src="img/Slide10.webp" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>
            </div>
        </div>

        <div id="no2">
            <div id="container2">
                <!-- Info-text acting as a button here as well -->
                <div class="info-text" role="button" tabindex="0">
                    <p><span>&#9432;</span> How to Navigate</p> 
                </div>

                <button class="toggle-button2">&lt; Previous Page</button>

                <!-- Draggable Items with Low-res and High-res Images -->
                <div class="draggable" id="mobilehide">
                    <a href="cardgame.html">
                        <img src="img/low/Toolkits_02.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/Toolkits_02.gif" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="path.html">
                        <img src="img/low/Pathfinder_Background_V1.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/Pathfinder_Background_V1.png" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="newtennant.html">
                        <img src="img/low/catu02.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/catu02.png" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="for.html">
                        <img src="img/low/foresightcreative.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/low/foresightcreative.png" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>

                <div class="draggable">
                    <a href="flag.html">
                        <img src="img/low/Final-render-New-Flag-2draft-2.png" alt="Low-Res Image" class="low-res loading">
                        <img src="img/Final-render-New-Flag-2draft-2.png" alt="High-Res Image" class="high-res fade-in">
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="band">
        <h1>Playing The 'Port | Interactive Portfolio</h1>
        <a href="game.html" ><h2 style="color:#a251ff;  border: 1px solid #a251ff;">Explore</h2></a>
    </div>

    <div class="band" style="background-color: #171717;">
        <h1>AI Advertising & The Simulation of Diversity | Opinion</h1>
        <a href="aidiversity.html" ><h2 style="color:#ff414a;  border: 1px solid #ff414a;">Explore</h2></a>
    </div>
    <div class="band" style=" height: 2vh !important; padding: 2vw !important; background-color: #171717;">
    </div>
<!-- 
    <div class="band" >
        <h1>Political Material | Cultural Analysis</h1>
        <a href="pol.html" ><h2 style="color:#ff414a;  border: 1px solid #ff414a;">Explore</h2></a>
    </div>

    <div class="band" style="background-color: #171717;">
        <h1>Pathfinder | Engaging Brief</h1>
        <a href="path.html" ><h2 style="color:#9affe7;  border: 1px solid #9affe7;">Explore</h2></a>
    </div>

    <div class="band" >
        <h1>The New Tennant | Broad Sheet Newspaper</h1>
        <a href="newtennant.html" ><h2 style="color:#b472ff;  border: 1px solid #b472ff;">Explore</h2></a>
    </div>

    <div class="band" style="background-color: #171717;">
        <h1>GAZE Film Festival 2023 | Branding</h1>
        <a href="gaze23.html" ><h2 style="color:#d7d71f;  border: 1px solid #d7d71f;">Explore</h2></a>
    </div>
-->

    <footer>
        <div class="social-icons">
            <a href="https://www.instagram.com/patrickfeeneydesigner/" target="_blank" aria-label="Instagram" role="link">
                <img src="img/instagram-icon.png" alt="Instagram" tabindex="0">
            </a>
            <a href="mailto:patfeeney1098@gmail.com" target="_blank" aria-label="Email" role="link">
                <img src="img/email.png" alt="Email Me" tabindex="0">
            </a>
        </div>
        <div class="footer-text">
            &copy; Patrick Feeney Design 2024 | All rights reserved
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            let activeContainerId = "container1";
            let isDragging = false;
            let activeElement = null, offsetX = 0, offsetY = 0;
            let velocityX = 0, velocityY = 0;
            const friction = 0.95;
        
            // Keep track of highest z-index to ensure top-most element
            let zIndexCounter = 1000;
        
            const placedImagesData = { "container1": [], "container2": [] };
        
            // This object will store the final positions and z-index of each image.
            // Format: savedPositions[containerId] = [{left, top, zIndex}, ...] for each draggable.
            let savedPositions = {
                "container1": [],
                "container2": []
            };
        
            function setupDraggable(containerId) {
                const container = document.getElementById(containerId);
                const containerRect = container.getBoundingClientRect();
                const draggables = container.querySelectorAll('.draggable');
        
                // If we have saved positions for this container and they match the number of images,
                // just apply them without repositioning.
                if (savedPositions[containerId].length === draggables.length) {
                    draggables.forEach((elem, index) => {
                        const { left, top, zIndex: storedZIndex } = savedPositions[containerId][index];
                        elem.style.left = `${left}px`;
                        elem.style.top = `${top}px`;
                        if (storedZIndex) {
                            elem.style.zIndex = storedZIndex;
                            if (storedZIndex > zIndexCounter) {
                                zIndexCounter = storedZIndex;
                            }
                        }
                    });
                    return;
                }
        
                // If no saved positions, we must randomize now and then save them.
                placedImagesData[containerId] = [];
        
                draggables.forEach((elem, index) => {
                    const lowResImage = elem.querySelector('img.low-res');
                    const highResImage = elem.querySelector('img.high-res');
        
                    function setPosition() {
                        const elemWidth = elem.offsetWidth;
                        const elemHeight = elem.offsetHeight;
                        const maxX = containerRect.width - elemWidth;
                        const maxY = containerRect.height - elemHeight;
        
                        function overlapsForbiddenZone(testX, testY, testWidth, testHeight) {
                            for (const data of placedImagesData[containerId]) {
                                const A_left = testX;
                                const A_right = testX + testWidth;
                                const A_top = testY;
                                const A_bottom = testY + testHeight;
        
                                const B_left = data.forbiddenX1;
                                const B_right = data.forbiddenX2;
                                const B_top = data.forbiddenY1;
                                const B_bottom = data.forbiddenY2;
        
                                if (A_left < B_right && A_right > B_left && A_top < B_bottom && A_bottom > B_top) {
                                    return true;
                                }
                            }
                            return false;
                        }
        
                        let attempts = 500; 
                        let positioned = false;
                        let randomX, randomY;
        
                        while (attempts > 0 && !positioned) {
                            randomX = Math.floor(Math.random() * maxX);
                            randomY = Math.floor(Math.random() * maxY);
        
                            if (!overlapsForbiddenZone(randomX, randomY, elemWidth, elemHeight)) {
                                positioned = true;
                            }
                            attempts--;
                        }
        
                        if (!positioned) {
                            // If we ran out of attempts, just place it in the middle
                            randomX = Math.floor(maxX / 2);
                            randomY = Math.floor(maxY / 2);
                        }
        
                        elem.style.left = `${randomX}px`;
                        elem.style.top = `${randomY}px`;
        
                        const forbiddenZoneWidth = elemWidth * 0.22; 
                        const forbiddenZoneHeight = elemHeight * 0.22; 
                        const fzX1 = randomX + (elemWidth - forbiddenZoneWidth) / 2;
                        const fzY1 = randomY + (elemHeight - forbiddenZoneHeight) / 2;
                        const fzX2 = fzX1 + forbiddenZoneWidth;
                        const fzY2 = fzY1 + forbiddenZoneHeight;
        
                        placedImagesData[containerId].push({
                            forbiddenX1: fzX1,
                            forbiddenY1: fzY1,
                            forbiddenX2: fzX2,
                            forbiddenY2: fzY2
                        });
        
                        // Save the initial position and zIndex for this image
                        savedPositions[containerId][index] = {
                            left: randomX,
                            top: randomY,
                            zIndex: parseInt(elem.style.zIndex) || 1000
                        };
                    }
        
                    if (lowResImage.complete && lowResImage.naturalHeight !== 0) {
                        setPosition();
                    } else {
                        lowResImage.onload = setPosition;
                    }
        
                    // Double click detection on links (for both desktop and mobile)
                    let lastTapTime = 0;
                    const link = elem.querySelector('a');
                    link.addEventListener('touchend', function(e) {
                        const currentTime = new Date().getTime();
                        const tapGap = currentTime - lastTapTime;
                        if (tapGap < 300 && tapGap > 0) {
                            window.location.href = this.href;
                        }
                        lastTapTime = currentTime;
                        e.preventDefault();
                    }, false);
        
                    let clickTimeout = null;
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        if (clickTimeout !== null) {
                            clearTimeout(clickTimeout);
                            clickTimeout = null;
                            window.location.href = this.href;
                        } else {
                            clickTimeout = setTimeout(() => {
                                clickTimeout = null;
                            }, 300);
                        }
                    });
                });
            }
        
            setupDraggable("container1");
        
            function startDrag(e) {
                const container = document.getElementById(activeContainerId);
                const target = (e.targetTouches && e.targetTouches[0]) ? e.targetTouches[0].target : e.target;
                if (target.closest && target.closest('.draggable')) {
                    activeElement = target.closest('.draggable');
                    const rect = activeElement.getBoundingClientRect();
                    const containerRect = container.getBoundingClientRect();
                    const clientX = (e.targetTouches && e.targetTouches[0]) ? e.targetTouches[0].clientX : e.clientX;
                    const clientY = (e.targetTouches && e.targetTouches[0]) ? e.targetTouches[0].clientY : e.clientY;
        
                    offsetX = clientX - rect.left;
                    offsetY = clientY - rect.top;
                    isDragging = true;
                    velocityX = 0;
                    velocityY = 0;
        
                    zIndexCounter++;
                    activeElement.style.zIndex = zIndexCounter;
        
                    activeElement.classList.add('dragging');
                    e.preventDefault();
                }
            }
        
            function onMove(e) {
                if (isDragging && activeElement) {
                    const container = document.getElementById(activeContainerId);
                    const containerRect = container.getBoundingClientRect();
                    const clientX = (e.targetTouches && e.targetTouches[0]) ? e.targetTouches[0].clientX : e.clientX;
                    const clientY = (e.targetTouches && e.targetTouches[0]) ? e.targetTouches[0].clientY : e.clientY;
        
                    const newX = clientX - containerRect.left - offsetX;
                    const newY = clientY - containerRect.top - offsetY;
        
                    velocityX = newX - parseFloat(activeElement.style.left || 0);
                    velocityY = newY - parseFloat(activeElement.style.top || 0);
        
                    activeElement.style.left = `${newX}px`;
                    activeElement.style.top = `${newY}px`;
                }
            }
        
            function endDrag() {
                if (isDragging) {
                    isDragging = false;
        
                    if (activeElement) {
                        activeElement.classList.remove('dragging');
                        activeElement.classList.add('dropped');
                        activeElement.addEventListener('animationend', function handleAnimationEnd() {
                            activeElement.classList.remove('dropped');
                            activeElement.removeEventListener('animationend', handleAnimationEnd);
                        });
        
                        // Update saved position after user stops dragging
                        const container = document.getElementById(activeContainerId);
                        const draggables = Array.from(container.querySelectorAll('.draggable'));
                        const index = draggables.indexOf(activeElement);
                        if (index > -1) {
                            savedPositions[activeContainerId][index].left = parseFloat(activeElement.style.left);
                            savedPositions[activeContainerId][index].top = parseFloat(activeElement.style.top);
                            savedPositions[activeContainerId][index].zIndex = parseInt(activeElement.style.zIndex);
                        }
                    }
        
                    // Apply momentum
                    function applyMomentum() {
                        if (!isDragging && activeElement) {
                            const container = document.getElementById(activeContainerId);
                            const containerRect = container.getBoundingClientRect();
        
                            let newX = parseFloat(activeElement.style.left || 0) + velocityX;
                            let newY = parseFloat(activeElement.style.top || 0) + velocityY;
        
                            velocityX *= friction;
                            velocityY *= friction;
        
                            newX = Math.max(0, Math.min(containerRect.width - activeElement.offsetWidth, newX));
                            newY = Math.max(0, Math.min(containerRect.height - activeElement.offsetHeight, newY));
        
                            activeElement.style.left = `${newX}px`;
                            activeElement.style.top = `${newY}px`;
        
                            // Update saved position after momentum movement
                            const draggables = Array.from(container.querySelectorAll('.draggable'));
                            const index = draggables.indexOf(activeElement);
                            if (index > -1) {
                                savedPositions[activeContainerId][index].left = newX;
                                savedPositions[activeContainerId][index].top = newY;
                            }
        
                            if (Math.abs(velocityX) > 0.5 || Math.abs(velocityY) > 0.5) {
                                requestAnimationFrame(applyMomentum);
                            }
                        }
                    }
                    applyMomentum();
                }
            }
        
            document.addEventListener('mousedown', startDrag, false);
            document.addEventListener('mousemove', onMove, false);
            document.addEventListener('mouseup', endDrag, false);
            document.addEventListener('touchstart', startDrag, {passive: false});
            document.addEventListener('touchmove', onMove, {passive: false});
            document.addEventListener('touchend', endDrag, false);
        
            // Toggle between pages without re-randomizing.
            document.querySelector(".toggle-button1").addEventListener("click", () => {
                document.getElementById("no1").style.display = "none";
                document.getElementById("no2").style.display = "block";
                activeContainerId = "container2";
                setupDraggable("container2");
            });
        
            document.querySelector(".toggle-button2").addEventListener("click", () => {
                document.getElementById("no2").style.display = "none";
                document.getElementById("no1").style.display = "block";
                activeContainerId = "container1";
                setupDraggable("container1");
            });
        
            // Lazy load high-resolution images
            const highResImages = document.querySelectorAll('img.high-res');
            const loadHighResImage = (img) => {
                const highResSrc = img.src;
                if (!highResSrc) return;
                const highResImg = new Image();
                highResImg.src = highResSrc;
                highResImg.onload = () => {
                    img.classList.add('loaded');
                    // Remove blur from low-res image
                    const lowResImg = img.previousElementSibling;
                    if (lowResImg && lowResImg.classList.contains('loading')) {
                        lowResImg.classList.remove('loading');
                    }
                };
            };
        
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries, obs) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            loadHighResImage(img);
                            obs.unobserve(img);
                        }
                    });
                }, {
                    rootMargin: "50px",
                    threshold: 0.1
                });
        
                highResImages.forEach(img => {
                    observer.observe(img);
                });
            } else {
                highResImages.forEach(img => loadHighResImage(img));
            }
        
            // Close the overlay when "Got it!" is clicked
            document.getElementById('closeInstructionBtn').addEventListener('click', () => {
                document.getElementById('instructionOverlay').style.display = 'none';
            });
        
            // Show overlay again when info-text is clicked
            const infoTexts = document.querySelectorAll('.info-text');
            infoTexts.forEach(infoText => {
                infoText.addEventListener('click', () => {
                    document.getElementById('instructionOverlay').style.display = 'flex';
                });
            });
        });
    </script>
</body>
</html>
